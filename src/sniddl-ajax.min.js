function Sniddl(query, options) {return Sniddl.init(query, options)}Sniddl.init = function(query, options={}) {var elements = document.querySelectorAll(query);if (options.addCss) Sniddl.addCss(query);for (var i = 0; i < elements.length; i++) {var el = elements[i];el["__sniddl__"] = new SniddlComponent(el, options);}return elements;}Sniddl.addCss = function(query) {var css = query + ':hover{cursor: pointer;}';var style = document.createElement('style');if (style.styleSheet) style.styleSheet.cssText = css;else style.appendChild(document.createTextNode(css));document.getElementsByTagName('head')[0].appendChild(style);}function SniddlComponent(el, options) {this.el = el;var a = this.el.getAttribute.bind(this.el);var h = this.el.hasAttribute.bind(this.el);this.url = a('url') || a('data-url');this.params = a('params') || a('data-params');this.data = options.params;this.headers = options.headers;this.method = (a('method') || a('data-method'));this.onerror = (a('onerror') || a('data-onerror')) || console.error;this.onsuccess = a('onsuccess') || a('data-onsuccess');this.redirect = h('redirect') || h('data-redirect');this.blank = h('blank') || h('data-blank');this.removeAttributes('url data-url params data-params method data-method onerror data-onerror onsuccess data-onsuccess redirect data-redirect blank data-blank');if (this.params) this.params = JSON.parse(this.params);this.params = Object.assign(this.params || {}, this.data);this.el.onclick = this.click;}SniddlComponent.prototype.removeAttributes = function(str) {var attrs = str.split(' ')for (var i = 0; i < attrs.length; i++) {this.el.removeAttribute(attrs[i])}}SniddlComponent.prototype.click = function(e) {e.preventDefault();e.stopPropagation();if(e.target.href) return e.target.target ? window.open(e.target.href, e.target.target) : window.location.href = e.target.href;var s = this['__sniddl__'];if (!s.method) return s.blank ? window.open(s.url, '_blank') : window.location.href = s.url;else if (s.redirect) s.formRequest()else return s.xmlRequest()}SniddlComponent.prototype.formRequest = function(data) {var form = document.createElement('form');form.setAttribute('method', this.method);form.setAttribute('action', this.url);form.style.display = 'none';document.body.appendChild(form);for (var key in this.params) {var input = document.createElement('input');input.setAttribute('name', key);input.setAttribute('value', this.params[key]);input.setAttribute('type', 'hidden');form.appendChild(input)}form.submit()}SniddlComponent.prototype.xmlRequest = function() {var x = new XMLHttpRequest();x.open(this.method, this.url);if (!this.headers['content-type']) x.setRequestHeader('content-type', 'application/json');if (this.headers) {for (var key in this.headers) {x.setRequestHeader(key, this.headers[key]);}}x.onload = function () {var res = JSON.parse(x.responseText);if (x.status >= 200 && x.status < 300 && this.onsuccess) {window[this.onsuccess](res)} else if (x.status < 200 || x.status >= 300) {if (this.onerror === console.error) console.error('Sniddl Ajax Response Error:', res);else window[this.onerror](res)}}.bind(this)x.send(JSON.stringify(this.params))}Sniddl.prototype.constructor = Sniddl;SniddlComponent.prototype.constructor = SniddlComponent;
